<link rel="import" href="../polymer/polymer.html">
<link rel="stylesheet" href="../nvd3/build/nv.d3.min.css" />

<polymer-element name="pie-chart" attributes="todo inProgress done"> 
	<template>
		<link rel="stylesheet" href="../nvd3/build/nv.d3.min.css" />
		<span>There are {{todo}} open issues, {{inProgress}} in progress
			and {{done}} issues done. </span> 
		<div id="nvChart" class="nvChart"><svg style="width: 500px; height: 400px"></svg></div>
	</template> 
	<script type="text/javascript" src="../d3/d3.min.js"></script>
	<script type="text/javascript" src="../nvd3/build/nv.d3.min.js"></script>
	<script>
		Polymer({
			ready : function() {
				this.chart = nv.models.pieChart()
					.x(function(d) { return d.label })
					.y(function(d) { return d.value })
					.showLabels(true)
					.valueFormat(d3.format('d'));
				nv.addGraph(this.chart);
			},
			
			todoChanged : function(oldVal, newVal) {
				this.updateValues();
			},
			inProgressChanged : function(oldVal, newVal) {
				this.updateValues();
			},
			doneChanged : function(oldVal, newVal) {
				this.updateValues();
			},
			
			updateValues : function() {
				console.log('update values');
				var data = [
			            {label: 'Todo', 		value: this.todo}, 
			            {label: 'In progress', 	value: this.inProgress}, 
			            {label: 'Done', 		value: this.done}
			           ];
				d3.select(this.$.nvChart).select('svg')
				    .datum(data)
				    .transition().duration(350)
				    .call(this.chart);
			}
		});
	</script> 
</polymer-element>
